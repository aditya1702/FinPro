<!DOCTYPE html>
{% load static %}
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>FinPro</title>
  <!-- Favicon -->
  <link href="{% static 'img/brand/favicon.png' %}" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  <link href="{% static 'vendor/nucleo/css/nucleo.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/@fortawesome/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
  <!-- Argon CSS -->
  <link type="text/css" href="{% static 'css/argon.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.stockquotes.css' %}" />
  <link href="{% static 'css/cschart.css' %}" rel="stylesheet">
</head>

<body>
  <!-- Sidenav -->
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-gradient-dark" id="sidenav-main">
    <div class="container-fluid">
      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!--&lt;!&ndash; Brand &ndash;&gt;-->
      <!--<a class="navbar-brand pt-0" href="company-page.html">-->
        <!--<img src="assets/img/brand/blue.png" class="navbar-brand-img" alt="...">-->
      <!--</a>-->

      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Collapse header -->
        <div class="navbar-collapse-header d-md-none">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a href="company-page.html">
                <img src="{% static 'img/brand/blue.png' %}">
              </a>
            </div>
            <div class="col-6 collapse-close">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                <span></span>
                <span></span>
              </button>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/dashboard.html/?user={{ username }}">
              <i class="ni ni-tv-2 text-primary"></i> <span style="color: darkorange">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/maps.html/?user={{ username }}">
              <i class="ni ni-pin-3 text-orange"></i> <span style="color: darkorange">Global Market</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/profile.html/?user={{ username }}">
              <i class="ni ni-single-02 text-yellow"></i> <span style="color: darkorange">Account</span>
            </a>
          </li>
          <li style="margin-top: 15px;margin-left: 15px">
            <!-- Form -->
            <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
              <div class="form-group mb-0">
                <div class="input-group input-group-alternative">
                  <div class="input-group-prepend">
                    <span class="input-group-text" onclick="search()"><i class="fas fa-search"></i></span>
                  </div>
                  <input id="org" name="org" value="" class="form-control" placeholder = "Search" type="text" style="width: 150px;height: 50px;">
                  <script type="text/javascript">
                      function search(){
                        window.location = '/company-page/?org=' + document.getElementById('org').value;
                      }
                  </script>
                </div>
              </div>
            </form>
          </li>
        </ul>

        <!-- Divider -->
        <!--<hr class="my-3">-->
        <!--&lt;!&ndash; Heading &ndash;&gt;-->
        <!--<h6 class="navbar-heading text-muted">Documentation</h6>-->
        <!--&lt;!&ndash; Navigation &ndash;&gt;-->
        <!--<ul class="navbar-nav mb-md-3">-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html">-->
              <!--<i class="ni ni-spaceship"></i> Getting started-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html">-->
              <!--<i class="ni ni-palette"></i> Foundation-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html">-->
              <!--<i class="ni ni-ui-04"></i> Components-->
            <!--</a>-->
          <!--</li>-->
        <!--</ul>-->
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <div class="main-content">
    <!-- Top navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">

        <!-- Brand -->
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
              "symbols": [
                {
                  "title": "S&P 500",
                  "proName": "INDEX:SPX"
                },
                {
                  "title": "EUR/USD",
                  "proName": "FX_IDC:EURUSD"
                },
                {
                  "title": "BTC/USD",
                  "proName": "BITFINEX:BTCUSD"
                },
                {
                  "title": "ETH/USD",
                  "proName": "BITFINEX:ETHUSD"
                }
              ],
              "theme": "dark",
              "isTransparent": true,
              "displayMode": "regular",
              "locale": "en"
            }
          </script>

         <!--User-->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="{% static 'img/theme/team-4-800x800.jpg' %}">
                </span>
                <div class="media-body ml-2 d-none d-lg-block">
                  <span class="mb-0 text-sm  font-weight-bold">{{ username }}</span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome!</h6>
              </div>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-single-02"></i>
                <span>My profile</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-settings-gear-65"></i>
                <span>Settings</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-calendar-grid-58"></i>
                <span>Activity</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-support-16"></i>
                <span>Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="http://localhost:8000/login.html" class="dropdown-item">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>

      </div>
    </nav>
    <!-- Header -->
    <div class="header bg-gradient-dark pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">
        </div>
      </div>
    </div>

    <!-- Page content -->
    <div class="container-fluid mt--7 bg-gradient-dark">
      <div class="row">
        <div class="col">
          <div class="card-map border-0 bg-gradient-dark">
            <div id="tooltip" class="bg-gradient-dark"></div><!-- div to hold tooltip. -->
            <svg id="statesvg" width="950" height="600" class="bg-gradient-dark" style="margin-top: 11px;margin-left: 10px;"></svg>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="footer bg-gradient-dark">
        <div class="row align-items-center justify-content-xl-between">
          <div class="col-xl-6">
          </div>
        </div>
      </footer>

    </div>
  </div>
  <script src="{% static 'vendor/jquery/dist/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

  <!-- Optional JS -->
  <script src="{% static 'vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'vendor/chart.js/dist/Chart.extension.js' %}"></script>
  <script src="{% static 'js/argon.js' %}"></script>

  <!-- Optional JS -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>

  <script src="{% static 'js/uStates.js' %}"></script> <!-- creates uStates. -->
  <script>
      function tooltipHtml(n, d){	/* function to create html content string in tooltip div. */
          return "<h4>"+n+"</h4><table>"+
              "<tr><td>Low</td><td>"+(d.low)+"</td></tr>"+
              "<tr><td>Average</td><td>"+(d.avg)+"</td></tr>"+
              "<tr><td>High</td><td>"+(d.high)+"</td></tr>"+
              "</table>";
      }

      var sampleData ={};	/* Sample random data. */
      ["HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
      "ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY", "OH",
      "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ", "NV", "UT",
      "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS", "IN", "IL", "MN",
      "WI", "MO", "AR", "OK", "KS", "LS", "VA"]
          .forEach(function(d){
              var low = Math.round(100*Math.random()),
                  mid = Math.round(100*Math.random()),
                  high = Math.round(100*Math.random());
              sampleData[d] = {low:d3.min([low,mid,high]),
                                high:d3.max([low,mid,high]),
                      avg:Math.round((low+mid+high)/3),
                  color:d3.interpolate("#024b6e", "#60cefc")(low/100)};
          });

      /* draw states on id #statesvg */
      uStates.draw("#statesvg", sampleData, tooltipHtml);
      d3.select(self.frameElement).style("height", "600px");
</script>
<script type="text/javascript">

  $(document).ready(function(){

    $("#showMap1").addClass("map_active");
    $("#openmap1").show();
    $("#openmap2").hide();
    $("#openmap3").hide();
    $("#openmap4").hide();
    $("#closemap1").hide();
    $("#closemap2").hide();
    $("#closemap3").hide();
    $("#closemap4").hide();
  });

  $("button").click(function(){
  $("button").removeClass("map_active");
  $(this).addClass("map_active");
});

$("#showMap1").click(function(){
  $("#openmap1").show();
  $("#openmap2").hide();
  $("#openmap3").hide();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap1").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap1").show();
      $("#closemap1").hide();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap2").click(function(){
  $("#openmap1").hide();
  $("#openmap2").show();
  $("#openmap3").hide();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap2").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap2").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap3").click(function(){
  $("#openmap1").hide();
  $("#openmap2").hide();
  $("#openmap3").show();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap3").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap2").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap3").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap2").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap4").click(function(){
  $("#openmap1").hide();
  $("#openmap2").hide();
  $("#openmap3").hide();
  $("#openmap4").show();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap4").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap3").hide();
      $("#closemap2").hide();
    } else {
      $("#openmap4").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap3").hide();
      $("#openmap2").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});


$(function() {
  if ($("#showMap1").hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap1").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap1").show();
      $("#closemap1").hide();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

  var data = [{
    color: "#ff0000",
    label: 'Less than -1%'
  }, {
    color: "#ff3838",
    label: '-1 to -0.5%'
  }, {
    color: "#ff7575",
    label: '-0.5 to 0%'
  }, {
    color: "#96dd7e",
    label: '0 to +0.5%'
  }, {
    color: "#5bbc3a",
    label: '+0.5 to +1%'
  }, {
    color: "#218700",
    label: 'Greater than +1%'
  }]

  var width = 1000;
  var height = 50;
  var file = "{% static 'wsj_dataset_compact.csv' %}"

  var svg = d3.select('main-panel')
    .append('svg')
    .attr('width', width)
    .attr('height', height);


    var grad = svg.append('defs')
      .append('linearGradient')
      .attr('id', 'grad')
      .attr('x1', '0%')
      .attr('x2', '100%')
      .attr('y1', '0%')
      .attr('y2', '0%');

      grad.selectAll('stop')
        .data(data)
        .enter()
        .append('stop')
        .attr('offset', function(d, i) {
          return (i / data.length) * 100 + '%';
        })
        .style('stop-color', function(d) {
          return d.color;
        })
        .style('stop-opacity', 0.9);

        svg.append('rect')
          .attr('x', 0)
          .attr('y', 0)
          .attr('width', width)
          .attr('height', height / 2)
          .attr('fill', 'url(#grad)');

        var g = svg.append('g')
          .selectAll('.label')
          .data(data)
          .enter();

        g.append('line')
          .style('stroke', function(d) {
            return d.color;
          })
          .style('stroke-width', 5)
          .attr('x1',function(d,i){
            return xPos(i)
          })
          .attr('x2',function(d,i){
            return xPos(i)
          })
          .attr('y1',function(d,i){
            return height / 2;
          })
           .attr('y2',function(d,i){
            return height
          });


        g.append('text')
          .text(function(d){
            return d.label;
          })
          .attr('transform',function(d,i){
            return 'translate(' + (xPos(i) + 15) + ',' + ((height) - 7) + ')';
          })

        //g.append("title")
        //.attr("title","yo mamam");

        // add title to scale //

        function xPos(i){
          return (width / data.length) * i;
        }

//$("svg").css({bottom: 200, left: 1000, position:'relative'});

var openMap1 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap1'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.daily_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
          done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});
console.log(openmap1)


d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap1.updateChoropleth(csvdata1);
}
);

var closedMap1 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap1'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.daily_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
////////////////
          done: function(closedMap1) {

      closedMap1.svg.selectAll('.datamaps-subunit').on('click', function(geo) {
        //var localData = closedMap1.options.data[geo.id]
        //if ( localData && localData.numberOfThings ) {
        //  alert(localData.numberOfThings)
        //}
        ///////////////////////////
        console.log("yoipeeeee!")
      })
    },
      done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap1.updateChoropleth(csvdata1);
}
);

var openMap2 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap2'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.ytd_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {}
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap2.updateChoropleth(csvdata1);
}
);

var closedMap2 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap2'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.ytd_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap2.updateChoropleth(csvdata1);
}
);

var openMap3 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap3'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.year_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap3.updateChoropleth(csvdata1);
}
);

var closedMap3 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap3'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.year_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap3.updateChoropleth(csvdata1);
}
);

var openMap4 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap4'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.threeYear_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap4.updateChoropleth(csvdata1);
}
);

var closedMap4 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap4'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.threeYear_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap4.updateChoropleth(csvdata1);
}
);
  </script>

</body>

</html>