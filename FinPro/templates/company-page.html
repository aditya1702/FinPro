<!DOCTYPE html>
{% load static %}
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>Argon Dashboard - Free Dashboard for Bootstrap 4</title>
  <!-- Favicon -->
  <link href="{% static 'img/brand/favicon.png' %}" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  <link href="{% static 'vendor/nucleo/css/nucleo.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/@fortawesome/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
  <!-- Argon CSS -->
  <link type="text/css" href="{% static 'css/argon.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.stockquotes.css' %}" />
  <link href="{% static 'css/cschart.css' %}" rel="stylesheet">
</head>

<body>
  <!-- Sidenav -->
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-gradient-dark" id="sidenav-main">
    <div class="container-fluid">

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Brand -->
      <!--<a class="navbar-brand pt-0" href="company-page.html">-->
        <!--<img src="{% static 'img/brand/blue.png' %}" class="navbar-brand-img" alt="...">-->
      <!--</a>-->

      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Collapse header -->
        <div class="navbar-collapse-header d-md-none">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a href="company-page.html">
                <img src="{% static 'img/brand/blue.png' %}">
              </a>
            </div>
            <div class="col-6 collapse-close">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                <span></span>
                <span></span>
              </button>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/dashboard.html">
              <i class="ni ni-tv-2 text-primary"></i> <span style="color: darkorange">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/maps.html">
              <i class="ni ni-pin-3 text-orange"></i> <span style="color: darkorange">Global Market</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/profile.html">
              <i class="ni ni-single-02 text-yellow"></i> <span style="color: darkorange">Account</span>
            </a>
          </li>
          <li style="margin-top: 15px;margin-left: 15px">
            <!-- Form -->
            <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
              <div class="form-group mb-0">
                <div class="input-group input-group-alternative">
                  <div class="input-group-prepend">
                    <span class="input-group-text" onclick="search()"><i class="fas fa-search"></i></span>
                  </div>
                  <input id="org" name="org" value="" class="form-control" placeholder = "Search" type="text" style="width: 150px;height: 50px;">
                  <script type="text/javascript">
                      function search(){
                        window.location = '/company-page/?user={{ username }}&org=' + document.getElementById('org').value;
                      }
                  </script>
                </div>
              </div>
            </form>
          </li>
        </ul>

        <!-- Divider -->
        <!--<hr class="my-3">-->
        <!--&lt;!&ndash; Heading &ndash;&gt;-->
        <!--<h6 class="navbar-heading text-muted">Documentation</h6>-->
        <!--&lt;!&ndash; Navigation &ndash;&gt;-->
        <!--<ul class="navbar-nav mb-md-3">-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html">-->
              <!--<i class="ni ni-spaceship"></i> Getting started-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html">-->
              <!--<i class="ni ni-palette"></i> Foundation-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html">-->
              <!--<i class="ni ni-ui-04"></i> Components-->
            <!--</a>-->
          <!--</li>-->
        <!--</ul>-->

      </div>
    </div>
  </nav>

  <!-- Main content -->
  <div class="main-content">

    <!-- Top navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">

        <!-- Ticker Widget -->
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
              "symbols": [
                {
                  "title": "S&P 500",
                  "proName": "INDEX:SPX"
                },
                {
                  "title": "EUR/USD",
                  "proName": "FX_IDC:EURUSD"
                },
                {
                  "title": "BTC/USD",
                  "proName": "BITFINEX:BTCUSD"
                },
                {
                  "title": "ETH/USD",
                  "proName": "BITFINEX:ETHUSD"
                }
              ],
              "theme": "dark",
              "isTransparent": true,
              "displayMode": "regular",
              "locale": "en"
            }
          </script>

         <!--User-->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="{% static 'img/theme/team-4-800x800.jpg' %}">
                </span>
                <div class="media-body ml-2 d-none d-lg-block">
                  <span class="mb-0 text-sm  font-weight-bold">{{ username }}</span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome!</h6>
              </div>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-single-02"></i>
                <span>My profile</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-settings-gear-65"></i>
                <span>Settings</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-calendar-grid-58"></i>
                <span>Activity</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-support-16"></i>
                <span>Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="http://localhost:8000/login.html" class="dropdown-item">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>

      </div>
    </nav>

    <!-- Header -->
    <div class="header bg-gradient-dark pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">

          <!-- Card stats -->
          <div class="row">
            <div class="col-xl-3 col-lg-6">
              <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Ticker Symbol</h5>
                      <span class="h2 font-weight-bold mb-0" style="color: yellow;">{{ org_stock }}</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                        <i class="fas fa-chart-bar"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Sector</h5>
                      <span class="h2 font-weight-bold mb-0" style="color: yellow;">{{ org_sector }}</span>
                    </div>
                    <div class="col-auto">
                      <!--<div class="icon icon-shape bg-warning text-white rounded-circle shadow">-->
                        <!--<i class="fas fa-chart-pie"></i>-->
                      <!--</div>-->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">CEO</h5>
                      <span class="h2 font-weight-bold mb-0" style="color: yellow;">{{ org_ceo }}</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-pink text-white rounded-circle shadow">
                        <i class="fas fa-users"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Price</h5>
                      <h1><span class="stock-quote" data-symbol="{{ org_stock }}"></span></h1>
                    </div>
                    <div class="col-auto">
                      <!--<div class="icon icon-shape bg-gradient-warning text-white rounded-circle shadow">-->
                        <!--<i class="fas fa-percent"></i>-->
                      <!--</div>-->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page content -->
    <div class="container-fluid mt--7 bg-gradient-dark">
      <div class="row">
        <div class="col-xl-8 mb-5 mb-xl-0">

          <!-- Candlestick Chart -->
          <div class="card-candlestick bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <div id = "option">
                    <input id="oneM" name="1M" type="button" value="1M"/>
                    <input id="threeM" name="3M" type="button" value="3M" />
                    <input id="sixM" name="6M" type="button" value="6M" />
                    <input id="oneY" name="1Y" type="button" value="1Y" />
                    <input id="twoY" name="2Y" type="button" value="2Y" />
                    <input id="fourY" name="4Y" type="button" value="4Y" />
                  </div>
                  <div id="infobar">
                      <div id="infodate" class="infohead"></div>
                      <div id="infoopen" class="infobox"></div>
                      <div id="infohigh" class="infobox"></div>
                      <div id="infolow" class="infobox"></div>
                      <div id="infoclose" class="infobox"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "chart-candlestick">
                <div id = "chart1"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Technical Indicators Charts -->
      <div class="row mt-5">
          <div class="col-xl-8 mb-5 mb-xl-0">

          <div class="card-technical-indicators bg-gradient-dark shadow-dark">
            <div class="card-header-technical bg-transparent">
                <ul class="navbar-nav align-items-center d-none d-md-flex">
                  <li class="nav-item dropdown">
                    <a class="nav-link pr-0" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <div class="media align-items-center">
                        <span class="avatar avatar-sm rounded-circle bg-gradient-dark">
                          <i class="ni ni-sound-wave"></i>
                        </span>
                        <div class="media-body ml-2 d-none d-lg-block">
                          <span class="mb-0 text-white font-weight-bold">Charts</span>
                        </div>
                      </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
                      <div class=" dropdown-header noti-title">
                        <h6 class="text-overflow m-0">Technical Indicators</h6>
                      </div>
                      <a class="dropdown-item chart-type" data-chart-type="bb">
                        <i class="ni ni-chart-bar-32"></i>
                        <span>Bollinger Bands</span>
                      </a>
                      <a class="dropdown-item chart-type" data-chart-type="sma">
                        <i class="ni ni-chart-bar-32"></i>
                        <span>Simple Moving Averages</span>
                      </a>
                      <a class="dropdown-item chart-type" data-chart-type="ema">
                        <i class="ni ni-chart-bar-32"></i>
                        <span>EMA</span>
                      </a>
                      <a class="dropdown-item chart-type" data-chart-type="macd">
                        <i class="ni ni-chart-bar-32"></i>
                        <span>MACD</span>
                      </a>
                      <div class="dropdown-divider"></div>
                    </div>
                  </li>
                </ul>
            </div>
            <div class = "card-body">
              <div class = "chart-technical">
                <div id = "technical-bb"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Volume Chart -->
      <div class="row mt-6">
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card-bollinger bg-gradient-dark shadow-dark">
            <div class="card-header-technical bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "chart-volume">
                <div id = "volume" class="bg-gradient-dark"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Comparison Chart -->
        <div class="col-xl-4">
          <div class="card-moving-average bg-gradient-dark shadow-dark">
            <div class="card-header-technical bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "chart-volume">
                <div id = "comparison" class="bg-gradient-dark"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-7">

        <!-- News Articles -->
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent border-0 bg-gradient-dark">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="text-muted mb-0">News</h3>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-items-center table-dark bg-gradient-dark">
                <tbody>
                    {% for news_data in news %}
                        <tr>
                            <td><img src = '{{ news_data.image }}' alt="" border = 3 height=100 width=150 /></td>
                            <td class="text-left" onclick = "window.open('{{ news_data.url }}')"> {{ news_data.title }}</td>
                            <td><a href="#!" class="btn btn-sm btn-primary">Word Cloud</a></td>
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tweets -->
        <div class="col-xl-4">
          <div class="card bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent border-0 bg-gradient-dark">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0 text-muted">Tweets</h3>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-items-center table-dark bg-gradient-dark">
                <tbody>
                    {% for tweet in tweets %}
                        <tr>
                            <td class="text-left" onclick = "window.open('https://www.twitter.com/{{ tweet.name }}/status/{{ tweet.id }}')"> {{ tweet.text }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="row mt-8">
        <div class="col-xl-8 mb-5 mb-xl-0">

          <div class="card-recommendation bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                <div class="col">
                  <h3 class="text-muted mb-0">Recommendations</h3>
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "recommendations">
                  <div class="row">
                    {% for stock in recommendations %}
                      <div class="col-xl-3 col-lg-6">
                      <a onclick="window.open('/company-page/?user={{ username }}&org={{ stock.name }}')">
                        <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                        <span class="img__description"></span>
                        <div class="card-body" style="height: 150px">
                          <div class="row">
                            <div class="col">
                              <span class="title text-white">{{ stock.name }}</span>&nbsp;&nbsp;&nbsp;&nbsp;
                              <div class="tooltip-quotes">
                                <i class="ni ni-tag text-white"></i><span class="tooltiptext">{{stock.perc}}% of analysts agree that {{ stock.name }} is a {{ stock.action }}</span>
                                  </div>
                                </div>
                                <div class="col-auto" style="margin-top: 20px">
                                    <h1><span class="stock-quote" data-symbol="{{ stock.ticker }}"></span></h1>
                                </div>
                              </div>
                            </div>
                          </div>
                          </a>
                        </div>
                    {% endfor %}
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Footer -->
      <footer class="footer bg-gradient-dark">
        <div class="row align-items-center justify-content-xl-between">
          <div class="col-xl-6">
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Core -->
  <script src="{% static 'vendor/jquery/dist/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

  <!-- Optional JS -->
  <script src="{% static 'vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'vendor/chart.js/dist/Chart.extension.js' %}"></script>

  <!-- Argon JS -->
  <script src="{% static 'js/argon.js' %}"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>

{#  <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js?hcode=be5162d915534272a57d0bb781d27f2b"></script>#}
  <script src="{% static 'js/anystock_.js' %}"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js?hcode=be5162d915534272a57d0bb781d27f2b"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js?hcode=be5162d915534272a57d0bb781d27f2b"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-stock.min.js?hcode=be5162d915534272a57d0bb781d27f2b"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-data-adapter.min.js?hcode=be5162d915534272a57d0bb781d27f2b"></script>
  <link href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css?hcode=be5162d915534272a57d0bb781d27f2b" type="text/css" rel="stylesheet">
  <link href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css?hcode=be5162d915534272a57d0bb781d27f2b" type="text/css" rel="stylesheet">

  <!-- Technical Indicators -->
  <script>

    function computeBB(){
        anychart.data.loadCsvFile("{% static 'ohlc.csv' %}", function (data) {
            // create data table on loaded data
            var dataTable = anychart.data.table();
            dataTable.addData(data);

            // map loaded data for the ohlc series
            var mapping = dataTable.mapAs({
                'open': 1,
                'high': 2,
                'low': 3,
                'close': 4,
                'value': {'column': 4, 'type': 'close'}
            });

            // map loaded data for the scroller
            var scrollerMapping = dataTable.mapAs();
            scrollerMapping.addField('value', 5);

            // create stock chart
            var chart = anychart.stock();
            chart.background().fill({
              keys: ["#212529", "#212229"],
            });
            {#chart.getCredits().setEnabled(false);#}

            // create first plot on the chart
            var plot = chart.plot();
            plot.yGrid(true)
                    .xGrid(true)
                    .yMinorGrid(true)
                    .xMinorGrid(true);

            var series = plot.candlestick(mapping).name('{{ org_stock }}');
            series.legendItem().iconType('rising-falling');

            // create BBands indicator with period 20
            var bBandsIndicator = plot.bbands(mapping);
            bBandsIndicator.upperSeries().stroke('1.5 #3C8AD8');
            bBandsIndicator.middleSeries().stroke('1.5 #3C8AD8');
            bBandsIndicator.lowerSeries().stroke('1.5 #3C8AD8');

            // create scroller series with mapped data
            chart.scroller().line(mapping);

            // set chart selected date/time range
            chart.selectRange('2019-02-01', '2018-02-01');
            // set container id for the chart
            chart.container('technical-bb');
            // initiate chart drawing
            chart.draw();

            // create range picker
            var rangePicker = anychart.ui.rangePicker();
            // init range picker
            rangePicker.render(chart);

            // create range selector
            var rangeSelector = anychart.ui.rangeSelector();
            // init range selector
            rangeSelector.render(chart);
        });
    };

    function computeSMA(){
        anychart.data.loadCsvFile("{% static 'ohlc.csv' %}", function (data) {
            // create data table on loaded data
            var dataTable = anychart.data.table();
            dataTable.addData(data);

            // map loaded data
            var mapping = dataTable.mapAs({'value': 4});

            // create stock chart
            var chart = anychart.stock();
            chart.background().fill({
              keys: ["#212529", "#212229"],
            });

            // setting chart padding to fit both Y axes
            chart.padding(10, 50, 20, 50);

            // create plot on the chart
            var plot = chart.plot(0);
            // adding extra Y axis to the right side
            plot.yAxis(1).orientation('right');

            // create line series
            plot.line()
                    .name('{{ org_stock }}')
                    .data(mapping)
                    .stroke('2px #64b5f6');

            // create SMA indicator with period 20
            var sma20 = plot.sma(mapping, 20).series();
            sma20.name('SMA(20)')
                    .stroke('#bf360c');

            // create SMA indicator with period 20
            var sma50 = plot.sma(mapping, 50).series();
            sma50.name('SMA(50)')
                    .stroke('#ff6d00');

            // create scroller series with mapped data
            chart.scroller().line(mapping);
            // set container id for the chart
            chart.container('technical-sma');
            // initiate chart drawing
            chart.draw();

            // create range picker
            var rangePicker = anychart.ui.rangePicker();
            // init range picker
            rangePicker.render(chart);

            // create range selector
            var rangeSelector = anychart.ui.rangeSelector();
            // init range selector
            rangeSelector.render(chart);
        });
    };

    function computeEMA(){
        anychart.data.loadCsvFile("{% static 'ohlc.csv' %}", function (data) {
            // create data table on loaded data
            var dataTable = anychart.data.table();
            dataTable.addData(data);

            // map loaded data
            var mapping = dataTable.mapAs({'value': 4});

            // create stock chart
            var chart = anychart.stock();
            chart.background().fill({
              keys: ["#212529", "#212229"],
            });

            // setting chart padding to fit both Y axes
            chart.padding(10, 50, 20, 50);

            // create plot on the chart
            var plot = chart.plot(0);

            // create line series
            plot.line()
                    .name('{{ org_stock }}')
                    .data(mapping)
                    .stroke('2px #64b5f6');

            // create EMA indicator with period 50
            var ema50 = plot.ema(mapping, 30).series();
            ema50.stroke('#ffa000');

            // adding extra Y axis to the right side
            plot.yAxis(1).orientation('right');

            // create scroller series with mapped data
            chart.scroller().line(mapping);

            // set chart selected date/time range
            chart.selectRange('2019-02-01', '2018-02-01');
            // set container id for the chart
            chart.container('technical-ema');
            // initiate chart drawing
            chart.draw();

            // create range picker
            var rangePicker = anychart.ui.rangePicker();
            // init range picker
            rangePicker.render(chart);

            // create range selector
            var rangeSelector = anychart.ui.rangeSelector();
            // init range selector
            rangeSelector.render(chart);
        });
    };

    function computeMACD(){
        anychart.data.loadCsvFile("{% static 'ohlc.csv' %}", function (data) {
            // create data table on loaded data
            var dataTable = anychart.data.table();
            dataTable.addData(data);

            // map loaded data for the ohlc series
            var mapping = dataTable.mapAs();
            mapping.addField('value', 4, 'close');

            // create stock chart
            var chart = anychart.stock();
            chart.background().fill({
              keys: ["#212529", "#212229"],
            });

            // setting chart padding to fit both Y axes
            chart.padding(10, 50, 20, 50);

            // create first plot on the chart
            var plot = chart.plot(0);
            // adding extra Y axis to the right side
            plot.yAxis(1).orientation('right');

            // create line series
            plot.line()
                    .name('{{ org_stock }}')
                    .data(mapping)
                    .stroke('2px #64b5f6');

            // create first plot on the chart
            var secondPlot = chart.plot(1);
            secondPlot.height('30%');
            secondPlot.yAxis(1).orientation('right');

            // create MACD indicator with fast period 12, slow period 26 and signal period 9
            var macd = secondPlot.macd(mapping, 12, 26, 9);
            macd.macdSeries().stroke('#bf360c');
            macd.signalSeries().stroke('#ff6d00');
            macd.histogramSeries().fill('#ffe082');

            // create scroller series with mapped data
            chart.scroller().line(mapping);
            // set container id for the chart
            chart.container('technical-macd');
            // initiate chart drawing
            chart.draw();

            // create range picker
            var rangePicker = anychart.ui.rangePicker();
            // init range picker
            rangePicker.render(chart);

            // create range selector
            var rangeSelector = anychart.ui.rangeSelector();
            // init range selector
            rangeSelector.render(chart);
        });
    };

    $('.chart-type').click(function(){
            var type = $(this).attr("data-chart-type");
            if(type == "sma"){
                $(".chart-technical").html('<div id = "technical-sma" class="bg-gradient-dark"></div>');
                computeSMA();
            }
            else if(type == "bb"){
                $(".chart-technical").html('<div id = "technical-bb" class="bg-gradient-dark"></div>');
                computeBB();
            }
            else if(type == "ema"){
                $(".chart-technical").html('<div id = "technical-ema" class="bg-gradient-dark"></div>');
                computeEMA();
            }
            else{
                $(".chart-technical").html('<div id = "technical-macd" class="bg-gradient-dark"></div>');
                computeMACD();
            }
        });
        computeBB();
</script>

  <!-- HighStock JS -->
  <script src="{% static 'js/highstock.js' %}"></script>
  <script src="{% static 'js/exporting.js' %}"></script>
  <script src="{% static 'js/export-data.js' %}"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/stock/indicators/indicators.js"></script>
  <script src="https://code.highcharts.com/stock/indicators/pivot-points.js"></script>
  <script src="https://code.highcharts.com/stock/indicators/ema.js"></script>
  <script src="https://code.highcharts.com/stock/indicators/macd.js"></script>
  <script type="text/javascript">

    var seriesOptions = [],
        seriesCounter = 0

    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        Highcharts.theme = {
            colors: ['#2b908f', '#90ee7e', '#f45b5b', '#7798BF', '#aaeeee', '#ff0066',
                '#eeaaee', '#55BF3B', '#DF5353', '#7798BF', '#aaeeee'],
            chart: {
                backgroundColor: {
                    linearGradient: {x1: 0, y1: 0, x2: 1, y2: 1},
                    stops: [
                        [0, '#212529'],
                        [1, '#212229']
                    ]
                },
                style: {
                    fontFamily: '\'Unica One\', sans-serif'
                },
                plotBorderColor: '#606063'
            },
            title: {
                style: {
                    color: '#E0E0E3',
                    textTransform: 'uppercase',
                    fontSize: '20px'
                }
            },
            subtitle: {
                style: {
                    color: '#E0E0E3',
                    textTransform: 'uppercase'
                }
            },
            xAxis: {
                gridLineColor: '#707073',
                labels: {
                    style: {
                        color: '#E0E0E3'
                    }
                },
                lineColor: '#707073',
                minorGridLineColor: '#505053',
                tickColor: '#707073',
                title: {
                    style: {
                        color: '#A0A0A3'

                    }
                }
            },
            yAxis: {
                gridLineColor: '#707073',
                labels: {
                    style: {
                        color: '#E0E0E3'
                    }
                },
                lineColor: '#707073',
                minorGridLineColor: '#505053',
                tickColor: '#707073',
                tickWidth: 1,
                title: {
                    style: {
                        color: '#A0A0A3'
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.85)',
                style: {
                    color: '#F0F0F0'
                }
            },
            plotOptions: {
                series: {
                    dataLabels: {
                        color: '#B0B0B3'
                    },
                    marker: {
                        lineColor: '#333'
                    }
                },
                boxplot: {
                    fillColor: '#505053'
                },
                candlestick: {
                    lineColor: 'white'
                },
                errorbar: {
                    color: 'white'
                }
            },
            legend: {
                itemStyle: {
                    color: '#E0E0E3'
                },
                itemHoverStyle: {
                    color: '#FFF'
                },
                itemHiddenStyle: {
                    color: '#606063'
                }
            },
            credits: {
                style: {
                    color: '#666'
                }
            },
            labels: {
                style: {
                    color: '#707073'
                }
            },

            drilldown: {
                activeAxisLabelStyle: {
                    color: '#F0F0F3'
                },
                activeDataLabelStyle: {
                    color: '#F0F0F3'
                }
            },

            navigation: {
                buttonOptions: {
                    symbolStroke: '#DDDDDD',
                    theme: {
                        fill: '#505053'
                    }
                }
            },

            // scroll charts
            rangeSelector: {
                buttonTheme: {
                    fill: '#505053',
                    stroke: '#000000',
                    style: {
                        color: '#CCC'
                    },
                    states: {
                        hover: {
                            fill: '#707073',
                            stroke: '#000000',
                            style: {
                                color: 'white'
                            }
                        },
                        select: {
                            fill: '#000003',
                            stroke: '#000000',
                            style: {
                                color: 'white'
                            }
                        }
                    }
                },
                inputBoxBorderColor: '#505053',
                inputStyle: {
                    backgroundColor: '#333',
                    color: 'silver'
                },
                labelStyle: {
                    color: 'silver'
                }
            },

            navigator: {
                handles: {
                    backgroundColor: '#666',
                    borderColor: '#AAA'
                },
                outlineColor: '#CCC',
                maskFill: 'rgba(255,255,255,0.1)',
                series: {
                    color: '#7798BF',
                    lineColor: '#A6C7ED'
                },
                xAxis: {
                    gridLineColor: '#505053'
                }
            },

            scrollbar: {
                barBackgroundColor: '#808083',
                barBorderColor: '#808083',
                buttonArrowColor: '#CCC',
                buttonBackgroundColor: '#606063',
                buttonBorderColor: '#606063',
                rifleColor: '#FFF',
                trackBackgroundColor: '#404043',
                trackBorderColor: '#404043'
            },

            // special colors for some of the
            legendBackgroundColor: 'rgba(0, 0, 0, 0.5)',
            background2: '#505053',
            dataLabelsColor: '#B0B0B3',
            textColor: '#C0C0C0',
            contrastTextColor: '#F0F0F3',
            maskColor: 'rgba(255,255,255,0.3)'
        };

        // Apply the theme
        Highcharts.setOptions(Highcharts.theme);

        Highcharts.stockChart('comparison', {

                chart: {
                    height: 489
                },

                rangeSelector: {
                    selected: 4
                },

                yAxis: {
                    labels: {
                        formatter: function () {
                            return (this.value > 0 ? ' + ' : '') + this.value + '%';
                        }
                    },
                    plotLines: [{
                        value: 0,
                        width: 2,
                        color: 'silver'
                    }]
                },

                plotOptions: {
                    series: {
                        compare: 'percent',
                        showInNavigator: true
                    }
                },

                title: {
                    text: 'Stock Comparison'
                },

                tooltip: {
                    pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
                    valueDecimals: 2,
                    split: true
                },

                series: seriesOptions
            });
        }

        var names = {{ comparison_stocks|safe }};
        var all_comparison_data = {{ comparison_data|safe }};
        $.each(names, function (i, name) {

            function compareStocks(data) {

                seriesOptions[i] = {
                    name: name,
                    data: data
                };

                // As we're loading the data asynchronously, we don't know what order it will arrive. So
                // we keep a counter and create the chart when all the data is loaded.
                seriesCounter += 1;

                if (seriesCounter === names.length) {
                    createChart();
                }
            };
            data = all_comparison_data[i];
            compareStocks(data);
        });
  </script>

  <script type="text/javascript">
      Highcharts.theme = {
            colors: ['#2b908f', '#90ee7e', '#f45b5b', '#7798BF', '#aaeeee', '#ff0066',
                '#eeaaee', '#55BF3B', '#DF5353', '#7798BF', '#aaeeee'],
            chart: {
                backgroundColor: {
                    linearGradient: {x1: 0, y1: 0, x2: 1, y2: 1},
                    stops: [
                        [0, '#212529'],
                        [1, '#212229']
                    ]
                },
                style: {
                    fontFamily: '\'Unica One\', sans-serif'
                },
                plotBorderColor: '#606063'
            },
            title: {
                style: {
                    color: '#E0E0E3',
                    textTransform: 'uppercase',
                    fontSize: '20px'
                }
            },
            subtitle: {
                style: {
                    color: '#E0E0E3',
                    textTransform: 'uppercase'
                }
            },
            xAxis: {
                gridLineColor: '#707073',
                labels: {
                    style: {
                        color: '#E0E0E3'
                    }
                },
                lineColor: '#707073',
                minorGridLineColor: '#505053',
                tickColor: '#707073',
                title: {
                    style: {
                        color: '#A0A0A3'

                    }
                }
            },
            yAxis: {
                gridLineColor: '#707073',
                labels: {
                    style: {
                        color: '#E0E0E3'
                    }
                },
                lineColor: '#707073',
                minorGridLineColor: '#505053',
                tickColor: '#707073',
                tickWidth: 1,
                title: {
                    style: {
                        color: '#A0A0A3'
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.85)',
                style: {
                    color: '#F0F0F0'
                }
            },
            plotOptions: {
                series: {
                    dataLabels: {
                        color: '#B0B0B3'
                    },
                    marker: {
                        lineColor: '#333'
                    }
                },
                boxplot: {
                    fillColor: '#505053'
                },
                candlestick: {
                    lineColor: 'white'
                },
                errorbar: {
                    color: 'white'
                }
            },
            legend: {
                itemStyle: {
                    color: '#E0E0E3'
                },
                itemHoverStyle: {
                    color: '#FFF'
                },
                itemHiddenStyle: {
                    color: '#606063'
                }
            },
            credits: {
                style: {
                    color: '#666'
                }
            },
            labels: {
                style: {
                    color: '#707073'
                }
            },

            drilldown: {
                activeAxisLabelStyle: {
                    color: '#F0F0F3'
                },
                activeDataLabelStyle: {
                    color: '#F0F0F3'
                }
            },

            navigation: {
                buttonOptions: {
                    symbolStroke: '#DDDDDD',
                    theme: {
                        fill: '#505053'
                    }
                }
            },

            // scroll charts
            rangeSelector: {
                buttonTheme: {
                    fill: '#505053',
                    stroke: '#000000',
                    style: {
                        color: '#CCC'
                    },
                    states: {
                        hover: {
                            fill: '#707073',
                            stroke: '#000000',
                            style: {
                                color: 'white'
                            }
                        },
                        select: {
                            fill: '#000003',
                            stroke: '#000000',
                            style: {
                                color: 'white'
                            }
                        }
                    }
                },
                inputBoxBorderColor: '#505053',
                inputStyle: {
                    backgroundColor: '#333',
                    color: 'silver'
                },
                labelStyle: {
                    color: 'silver'
                }
            },

            navigator: {
                handles: {
                    backgroundColor: '#666',
                    borderColor: '#AAA'
                },
                outlineColor: '#CCC',
                maskFill: 'rgba(255,255,255,0.1)',
                series: {
                    color: '#7798BF',
                    lineColor: '#A6C7ED'
                },
                xAxis: {
                    gridLineColor: '#505053'
                }
            },

            scrollbar: {
                barBackgroundColor: '#808083',
                barBorderColor: '#808083',
                buttonArrowColor: '#CCC',
                buttonBackgroundColor: '#606063',
                buttonBorderColor: '#606063',
                rifleColor: '#FFF',
                trackBackgroundColor: '#404043',
                trackBorderColor: '#404043'
            },

            // special colors for some of the
            legendBackgroundColor: 'rgba(0, 0, 0, 0.5)',
            background2: '#505053',
            dataLabelsColor: '#B0B0B3',
            textColor: '#C0C0C0',
            contrastTextColor: '#F0F0F3',
            maskColor: 'rgba(255,255,255,0.3)'
        };

        // Apply the theme
        Highcharts.setOptions(Highcharts.theme);

        function computeVolume() {

            var data = {{ volume_json|safe}};

            // create the chart
            Highcharts.stockChart('volume', {
                chart: {
                    alignTicks: false,
                    height: 489
                },

                credits: {
                    enabled: false
                },

                rangeSelector: {
                    selected: 1
                },

                title: {
                    text: '{{ org_stock }} Stock Volume'
                },

                series: [{
                    type: 'column',
                    name: '{{ org_stock }} Stock Volume',
                    data: data,
                    dataGrouping: {
                        units: [[
                            'week', // unit name
                            [1] // allowed multiples
                        ], [
                            'month',
                            [1, 2, 3, 4, 6]
                        ]]
                    }
                }]
            });
        };
        computeVolume();
  </script>

  <!-- Candlestick Chart JS -->
  <script type="text/javascript">

      function barchart() {

          var margin = {top: 300, right: 30, bottom: 10, left: 5 },
              width = 865, height = 60, mname = "mbar1";

          var MValue = "TURNOVER";

          function barrender(selection) {
            selection.each(function(data) {

              var x = d3.scale.ordinal()
                  .rangeBands([0, width]);

              var y = d3.scale.linear()
                  .rangeRound([height, 0]);

              var xAxis = d3.svg.axis()
                  .scale(x)
                  .tickFormat(d3.time.format(TFormat[TIntervals[TPeriod]]));

              var yAxis = d3.svg.axis()
                  .scale(y)
                  .ticks(Math.floor(height/50));

              var svg = d3.select(this).select("svg")
                 .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              x.domain(data.map(function(d) { return d.DATE; }));
              y.domain([0, d3.max(data, function(d) { return d[MValue]; })]).nice();

              var xtickdelta   = Math.ceil(60/(width/data.length));
              xAxis.tickValues(x.domain().filter(function(d, i) { return !((i+Math.floor(xtickdelta/2)) % xtickdelta); }));

              svg.append("g")
                  .attr("class", "axis yaxis")
                  .attr("transform", "translate(" + width + ",0)")
                  .call(yAxis.orient("right").tickFormat("").tickSize(0));

              var barwidth    = x.rangeBand();
              var fillwidth   = (Math.floor(barwidth*0.9)/2)*2+1;
              var bardelta    = Math.round((barwidth-fillwidth)/2);

              var mbar = svg.selectAll("."+mname+"bar")
                  .data([data])
                .enter().append("g")
                  .attr("class", mname+"bar");

              mbar.selectAll("rect")
                  .data(function(d) { return d; })
                .enter().append("rect")
                  .attr("class", mname+"fill")
                  .attr("x", function(d) { return x(d.DATE) + bardelta; })
                  .attr("y", function(d) { return y(d[MValue]); })
                  .attr("class", function(d, i) { return mname+i; })
                  .attr("height", function(d) { return y(0) - y(d[MValue]); })
                  .attr("width", fillwidth);
            });
          } // barrender
          barrender.mname = function(value) {
                    if (!arguments.length) return mname;
                    mname = value;
                    return barrender;
                };

          barrender.margin = function(value) {
                    if (!arguments.length) return margin.top;
                    margin.top = value;
                    return barrender;
                };

          barrender.MValue = function(value) {
                    if (!arguments.length) return MValue;
                    MValue = value;
                    return barrender;
                };

        return barrender;
        } // barchart


      function cschart() {

        var margin = {top: 0, right: 30, bottom: 40, left: 5},
            width = 865, height = 300, Bheight = 460;

        function csrender(selection) {
          selection.each(function() {

            var interval = TIntervals[TPeriod];

            var minimal  = d3.min(genData, function(d) { return d.LOW; });
            var maximal  = d3.max(genData, function(d) { return d.HIGH; });

            var extRight = width + margin.right;
            var x = d3.scale.ordinal()
                .rangeBands([0, width]);

            var y = d3.scale.linear()
                .rangeRound([height, 0]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .tickFormat(d3.time.format(TFormat[interval]));

            var yAxis = d3.svg.axis()
                .scale(y)
                .ticks(Math.floor(height/50));

            x.domain(genData.map(function(d) { return d.DATE; }));
            y.domain([minimal, maximal]).nice();

            var xtickdelta   = Math.ceil(60/(width/genData.length))
            xAxis.tickValues(x.domain().filter(function(d, i) { return !((i+Math.floor(xtickdelta/2)) % xtickdelta); }));

            var barwidth    = x.rangeBand();
            var candlewidth = Math.floor(d3.min([barwidth*0.8, 13])/2)*2+1;
            var delta       = Math.round((barwidth-candlewidth)/2);

            d3.select(this).select("svg").remove();
            var svg = d3.select(this).append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", Bheight + margin.top + margin.bottom)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.append("g")
                .attr("class", "axis xaxis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis.orient("bottom").outerTickSize(0));

            svg.append("g")
                .attr("class", "axis yaxis")
                .attr("transform", "translate(" + width + ",0)")
                .call(yAxis.orient("right").tickSize(0));

            svg.append("g")
                .attr("class", "axis grid")
                .attr("transform", "translate(" + width + ",0)")
                .call(yAxis.orient("left").tickFormat("").tickSize(width).outerTickSize(0));

            var bands = svg.selectAll(".bands")
                .data([genData])
              .enter().append("g")
                .attr("class", "bands");

            bands.selectAll("rect")
                .data(function(d) { return d; })
              .enter().append("rect")
                .attr("x", function(d) { return x(d.DATE) + Math.floor(barwidth/2); })
                .attr("y", 0)
                .attr("height", Bheight)
                .attr("width", 1)
                .attr("class", function(d, i) { return "band"+i; })
                .style("stroke-width", Math.floor(barwidth));

            var stick = svg.selectAll(".sticks")
                .data([genData])
              .enter().append("g")
                .attr("class", "sticks");

            stick.selectAll("rect")
                .data(function(d) { return d; })
              .enter().append("rect")
                .attr("x", function(d) { return x(d.DATE) + Math.floor(barwidth/2); })
                .attr("y", function(d) { return y(d.HIGH); })
                .attr("class", function(d, i) { return "stick"+i; })
                .attr("height", function(d) { return y(d.LOW) - y(d.HIGH); })
                .attr("width", 1)
                .classed("rise", function(d) { return (d.CLOSE>d.OPEN); })
                .classed("fall", function(d) { return (d.OPEN>d.CLOSE); });

            var candle = svg.selectAll(".candles")
                .data([genData])
              .enter().append("g")
                .attr("class", "candles");

            candle.selectAll("rect")
                .data(function(d) { return d; })
              .enter().append("rect")
                .attr("x", function(d) { return x(d.DATE) + delta; })
                .attr("y", function(d) { return y(d3.max([d.OPEN, d.CLOSE])); })
                .attr("class", function(d, i) { return "candle"+i; })
                .attr("height", function(d) { return y(d3.min([d.OPEN, d.CLOSE])) - y(d3.max([d.OPEN, d.CLOSE])); })
                .attr("width", candlewidth)
                .classed("rise", function(d) { return (d.CLOSE>d.OPEN); })
                .classed("fall", function(d) { return (d.OPEN>d.CLOSE); });

          });
        } // csrender

        csrender.Bheight = function(value) {
                    if (!arguments.length) return Bheight;
                    Bheight = value;
                    return csrender;
                };

        return csrender;
        } // cschart

      function genType(d) {
          d.DATE  = parseDate(d.DATE);
          d.LOW        = +d.LOW;
          d.HIGH       = +d.HIGH;
          d.OPEN       = +d.OPEN;
          d.CLOSE      = +d.CLOSE;
          d.TURNOVER   = +d.TURNOVER;
          {#d.VOLATILITY = +d.VOLATILITY;#}
          return d;
        }

        function timeCompare(date, interval) {
          if (interval == "week")       { var durfn = d3.time.monday(date); }
          else if (interval == "month") { var durfn = d3.time.month(date); }
          else { var durfn = d3.time.day(date); }
          return durfn;
        }

        function dataCompress(data, interval) {
          var compressedData  = d3.nest()
                         .key(function(d) { return timeCompare(d.DATE, interval); })
                         .rollup(function(v) { return {
                                 DATE:   timeCompare(d3.values(v).pop().DATE, interval),
                                 OPEN:        d3.values(v).shift().OPEN,
                                 LOW:         d3.min(v, function(d) { return d.LOW;  }),
                                 HIGH:        d3.max(v, function(d) { return d.HIGH; }),
                                 CLOSE:       d3.values(v).pop().CLOSE,
                                 TURNOVER:    d3.mean(v, function(d) { return d.TURNOVER; }),
                                 {#VOLATILITY:  d3.mean(v, function(d) { return d.VOLATILITY; })#}
                                }; })
                         .entries(data).map(function(d) { return d.values; });

          return compressedData;
        }

        function csheader() {

            function cshrender(selection) {
              selection.each(function(data) {

                var interval   = TIntervals[TPeriod];
                var format     = (interval=="month")?d3.time.format("%b %Y"):d3.time.format("%b %d %Y");
                var dateprefix = (interval=="month")?"Month of ":(interval=="week")?"Week of ":"";
                d3.select("#infodate").text(dateprefix + format(data.DATE));
                d3.select("#infoopen").text("O " + data.OPEN);
                d3.select("#infohigh").text("H " + data.HIGH);
                d3.select("#infolow").text("L " + data.LOW);
                d3.select("#infoclose").text("C " + data.CLOSE);

              });
            } // cshrender

            return cshrender;
            } // csheader


        var parseDate    = d3.time.format("%Y-%m-%d").parse;
        var TPeriod      = "3M";
        var TDays        = {"1M":21, "3M":63, "6M":126, "1Y":252, "2Y":504, "4Y":1008 };
        var TIntervals   = {"1M":"day", "3M":"day", "6M":"day", "1Y":"week", "2Y":"week", "4Y":"month" };
        var TFormat      = {"day":"%d %b '%y", "week":"%d %b '%y", "month":"%b '%y" };
        var genRaw, genData;

        function go() {

                genRaw = {{ stock_values|safe }};
                genRaw = genRaw.map(function(item){item.DATE = parseDate(item.DATE); return item;});
                mainjs();

        };

        function toSlice(data) { return data.slice(-TDays[TPeriod]); }

        function mainjs() {

          var toPress    = function() {
              genData = (TIntervals[TPeriod]!="day")?dataCompress(toSlice(genRaw), TIntervals[TPeriod]):toSlice(genRaw);
          };

          toPress();
          displayAll();
          d3.select("#oneM").on("click",   function(){ TPeriod  = "1M"; toPress(); displayAll(); });
          d3.select("#threeM").on("click", function(){ TPeriod  = "3M"; toPress(); displayAll(); });
          d3.select("#sixM").on("click",   function(){ TPeriod  = "6M"; toPress(); displayAll(); });
          d3.select("#oneY").on("click",   function(){ TPeriod  = "1Y"; toPress(); displayAll(); });
          d3.select("#twoY").on("click",   function(){ TPeriod  = "2Y"; toPress(); displayAll(); });
          d3.select("#fourY").on("click",  function(){ TPeriod  = "4Y"; toPress(); displayAll(); });
        }

        function displayAll() {
            changeClass();
            displayCS();
            displayGen(genData.length-1);
        }

        function changeClass() {
            if (TPeriod =="1M") {
                d3.select("#oneM").classed("active", true);
                d3.select("#threeM").classed("active", false);
                d3.select("#sixM").classed("active", false);
                d3.select("#oneY").classed("active", false);
                d3.select("#twoY").classed("active", false);
                d3.select("#fourY").classed("active", false);
            } else if (TPeriod =="6M") {
                d3.select("#oneM").classed("active", false);
                d3.select("#threeM").classed("active", false);
                d3.select("#sixM").classed("active", true);
                d3.select("#oneY").classed("active", false);
                d3.select("#twoY").classed("active", false);
                d3.select("#fourY").classed("active", false);
            } else if (TPeriod =="1Y") {
                d3.select("#oneM").classed("active", false);
                d3.select("#threeM").classed("active", false);
                d3.select("#sixM").classed("active", false);
                d3.select("#oneY").classed("active", true);
                d3.select("#twoY").classed("active", false);
                d3.select("#fourY").classed("active", false);
            } else if (TPeriod =="2Y") {
                d3.select("#oneM").classed("active", false);
                d3.select("#threeM").classed("active", false);
                d3.select("#sixM").classed("active", false);
                d3.select("#oneY").classed("active", false);
                d3.select("#twoY").classed("active", true);
                d3.select("#fourY").classed("active", false);
            } else if (TPeriod =="4Y") {
                d3.select("#oneM").classed("active", false);
                d3.select("#threeM").classed("active", false);
                d3.select("#sixM").classed("active", false);
                d3.select("#oneY").classed("active", false);
                d3.select("#twoY").classed("active", false);
                d3.select("#fourY").classed("active", true);
            } else {
                d3.select("#oneM").classed("active", false);
                d3.select("#threeM").classed("active", true);
                d3.select("#sixM").classed("active", false);
                d3.select("#oneY").classed("active", false);
                d3.select("#twoY").classed("active", false);
                d3.select("#fourY").classed("active", false);
            }
        }

        function displayCS() {
            var chart       = cschart().Bheight(460);
            d3.select("#chart1").call(chart);
            var chart       = barchart().mname("volume").margin(320).MValue("TURNOVER");
            d3.select("#chart1").datum(genData).call(chart);
            hoverAll();
        }

        function hoverAll() {
            d3.select("#chart1").select(".bands").selectAll("rect")
                  .on("mouseover", function(d, i) {
                      d3.select(this).classed("hoved", true);
                      d3.select(".stick"+i).classed("hoved", true);
                      d3.select(".candle"+i).classed("hoved", true);
                      d3.select(".volume"+i).classed("hoved", true);
                      d3.select(".sigma"+i).classed("hoved", true);
                      displayGen(i);
                  })
                  .on("mouseout", function(d, i) {
                      d3.select(this).classed("hoved", false);
                      d3.select(".stick"+i).classed("hoved", false);
                      d3.select(".candle"+i).classed("hoved", false);
                      d3.select(".volume"+i).classed("hoved", false);
                      d3.select(".sigma"+i).classed("hoved", false);
                      displayGen(genData.length-1);
                  });
        }

        function displayGen(mark) {
            var header      = csheader();
            d3.select("#infobar").datum(genData.slice(mark)[0]).call(header);
        }
        go();

  </script>


  <!-- Stock Quotes JS -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="{% static 'js/jquery.stockquotes.js' %}"></script>
  <script type="text/javascript">
      $(document).ready(function () {
        $('.stock-quote').stockQuote();
      });
  </script>
</body>

</html>
