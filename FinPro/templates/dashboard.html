<!DOCTYPE html>
{% load static %}
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>Argon Dashboard - Free Dashboard for Bootstrap 4</title>
  <!-- Favicon -->
  <link href="{% static 'img/brand/favicon.png' %}" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  <link href="{% static 'vendor/nucleo/css/nucleo.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/@fortawesome/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
  <!-- Argon CSS -->
  <link type="text/css" href="{% static 'css/argon.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.stockquotes.css' %}" />
  <link href="{% static 'css/cschart.css' %}" rel="stylesheet">
  <link href="{% static 'css/heatmap.css' %}" rel="stylesheet">
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">-->
  <!--<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">-->
</head>

<body>
  <!-- Sidenav -->
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-gradient-dark" id="sidenav-main">
    <div class="container-fluid">

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Brand -->
      <!--<a class="navbar-brand pt-0" href="company-page.html">-->
        <!--<img src="{% static 'img/brand/blue.png' %}" class="navbar-brand-img" alt="...">-->
      <!--</a>-->

      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Collapse header -->
        <div class="navbar-collapse-header d-md-none">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a href="company-page.html">
                <img src="{% static 'img/brand/blue.png' %}">
              </a>
            </div>
            <div class="col-6 collapse-close">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                <span></span>
                <span></span>
              </button>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/dashboard.html">
              <i class="ni ni-tv-2 text-primary"></i> <span style="color: darkorange">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/maps.html">
              <i class="ni ni-pin-3 text-orange"></i> <span style="color: darkorange">Global Market</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:8000/profile.html">
              <i class="ni ni-single-02 text-yellow"></i> <span style="color: darkorange">Account</span>
            </a>
          </li>
          <li style="margin-top: 15px;margin-left: 15px">

            <!-- Form -->
            <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
              <div class="form-group mb-0">
                <div class="input-group input-group-alternative">
                  <div class="input-group-prepend">
                    <span class="input-group-text" onclick="search()"><i class="fas fa-search"></i></span>
                  </div>
                  <input id="org" name="org" value="" class="form-control" placeholder = "Search" type="text" style="width: 150px;height: 50px;">
                  <script type="text/javascript">
                      function search(){
                          window.location = '/company-page/?org=' + document.getElementById('org').value;
                      }
                  </script>
                </div>
              </div>
            </form>
          </li>
        </ul>

        <!-- Divider -->
        <!--<hr class="my-3">-->
        <!--&lt;!&ndash; Heading &ndash;&gt;-->
        <!--<h6 class="navbar-heading text-muted">Documentation</h6>-->
        <!--&lt;!&ndash; Navigation &ndash;&gt;-->
        <!--<ul class="navbar-nav mb-md-3">-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html">-->
              <!--<i class="ni ni-spaceship"></i> Getting started-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html">-->
              <!--<i class="ni ni-palette"></i> Foundation-->
            <!--</a>-->
          <!--</li>-->
          <!--<li class="nav-item">-->
            <!--<a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html">-->
              <!--<i class="ni ni-ui-04"></i> Components-->
            <!--</a>-->
          <!--</li>-->
        <!--</ul>-->

      </div>
    </div>
  </nav>

  <!-- Main content -->
  <div class="main-content">

    <!-- Top navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">

        <!-- Ticker Widget -->
{#        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>#}
{#              {#}
{#              "symbols": [#}
{#                {#}
{#                  "title": "S&P 500",#}
{#                  "proName": "INDEX:SPX"#}
{#                },#}
{#                {#}
{#                  "title": "EUR/USD",#}
{#                  "proName": "FX_IDC:EURUSD"#}
{#                },#}
{#                {#}
{#                  "title": "BTC/USD",#}
{#                  "proName": "BITFINEX:BTCUSD"#}
{#                },#}
{#                {#}
{#                  "title": "ETH/USD",#}
{#                  "proName": "BITFINEX:ETHUSD"#}
{#                }#}
{#              ],#}
{#              "theme": "dark",#}
{#              "isTransparent": true,#}
{#              "displayMode": "regular",#}
{#              "locale": "en"#}
{#            }#}
{#          </script>#}

         <!--User-->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="{%static 'img/theme/team-4-800x800.jpg' %}">
                </span>
                <div class="media-body ml-2 d-none d-lg-block">
                  <span class="mb-0 text-sm  font-weight-bold">User</span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome!</h6>
              </div>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-single-02"></i>
                <span>My profile</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-settings-gear-65"></i>
                <span>Settings</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-calendar-grid-58"></i>
                <span>Activity</span>
              </a>
              <a href="profile.html" class="dropdown-item">
                <i class="ni ni-support-16"></i>
                <span>Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="http://localhost:8000/login.html" class="dropdown-item">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>

      </div>
    </nav>

    <!-- Header -->
    <div class="header bg-gradient-dark pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">

          <!-- Card stats -->
          <div class="row">

            <div class="col-xl-3 col-lg-6">
              <h1 class="greeting_" style="color:#fff">Welcome to FinPro</h1>
            </div>

            <div class="col-xl-3 col-lg-6" style="margin-left: -250px;">
              <!--<h1 class="greeting" style="color:#fff">Welcome to FinPro</h1>-->
              <img height="370" width="650" src="https://d2ue93q3u507c2.cloudfront.net/assets/generated_assets/979045da3ce9f72c98e1cb45f48bb356.svg"/>
            </div>

            <!-- Watchlist -->
            <div class="col-xl-3 col-lg-6">
              <div class="card-watchlist bg-gradient-dark shadow-dark">
                <div class="card-header bg-transparent border-0 bg-gradient-dark">
                  <div class="row align-items-center">
                    <div class="col">
                      <h3 class="mb-0 text-muted">Watchlist</h3>
                    </div>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table align-items-center table-dark bg-gradient-dark">
                    <tbody>
                      {% for item in watchlist %}
                        <tr>
                            <td scope="row" onclick = "window.open('/company-page/?org={{ item.name }}')">
                              <span class="title text-white">{{ item.name }}</span>
                            </td>
                            <td>
                              <span class="stock-quote" data-symbol='{{ item.ticker }}' ></span>
                            </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- Page content -->
    <div class="container-fluid mt--7 bg-gradient-dark">

      <!-- Heatmap Chart -->
      <div class="row">
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card-sector-treemap bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
              </div>
            </div>
            <div class = "card-body">
              <div class = "chart">
                <div id="heatmap"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Movers Chart -->
      <div class="row mt-5">
        <div class="col-xl-8 mb-5 mb-xl-0">

          <div class="card-recommendation bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                <div class="col">
                  <h3 class="text-muted mb-0">Top Gainers</h3>
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "recommendations">
                  <div class="row">
                    {% for stock in top_gainers %}
                      <div class="col-xl-3 col-lg-6">
                      <a onclick="window.open('/company-page/?org={{ stock.name }}')">
                        <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                        <span class="img__description"></span>
                        <div class="card-body" style="height: 150px">
                          <div class="row">
                            <div class="col">
                              <span class="title text-white">{{ stock.name }}</span>
                                </div>
                                <div class="col-auto" style="margin-top: 20px">
{#                                    <h1><span class="stock-quote" data-symbol="{{ stock.ticker }}"></span></h1>#}
                                    <span class="h2 font-weight-bold mb-0" style="color: {{ stock.color }};"> {{ stock.price }}</span><br/>
                                    <span class="h4 font-weight-bold mb-0" style="color: {{ stock.color }};"> {{ stock.change }}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          </a>
                        </div>
                    {% endfor %}
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Top Loosers Chart -->
      <div class="row mt-6">
        <div class="col-xl-8 mb-5 mb-xl-0">

          <div class="card-recommendation bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                <div class="col">
                  <h3 class="text-muted mb-0">Top Losers</h3>
                </div>
              </div>
            </div>
            <div class = "card-body">
              <div class = "recommendations">
                  <div class="row">
                    {% for stock in top_losers %}
                      <div class="col-xl-3 col-lg-6">
                      <a onclick="window.open('/company-page/?org={{ stock.name }}')">
                        <div class="card shadow-dark card-stats mb-4 mb-xl-0 bg-gradient-dark">
                        <span class="img__description"></span>
                        <div class="card-body" style="height: 150px">
                          <div class="row">
                            <div class="col">
                              <span class="title text-white">{{ stock.name }}</span>
                                </div>
                                <div class="col-auto" style="margin-top: 20px">
                                    <span class="h2 font-weight-bold mb-0" style="color: {{ stock.color }};"> {{ stock.price }}</span><br/>
                                    <span class="h4 font-weight-bold mb-0" style="color: {{ stock.color }};"> {{ stock.change }}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          </a>
                        </div>
                    {% endfor %}
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="row mt-7">

        <!-- News Articles -->
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card-recent-news bg-gradient-dark shadow-dark">
            <div class="card-header bg-transparent border-0 bg-gradient-dark">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="text-muted mb-0">Recent News</h3>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-items-center table-dark bg-gradient-dark">
                <tbody>
                    {% for news_data in news %}
                        <tr>
                            <td><img src = '{{ news_data.image }}' alt="" border = 3 height=100 width=150 /></td>
                            <td class="text-left" onclick = "window.open('{{ news_data.url }}')"> {{ news_data.title }}</td>
                            <td><a class="btn btn-sm btn-primary" onclick="showModal();">Word Cloud</a></td>
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

{#        <div class="row mt-7">#}
{#            <div class="col-xl-8 mb-5 mb-xl-0">#}
{#              <div class="card-sector-treemap bg-gradient-dark shadow-dark" id="word-cloud">#}
{#                <div class="card-header bg-transparent">#}
{#                  <div class="row align-items-center">#}
{#                  </div>#}
{#                </div>#}
{#                <div class = "card-body">#}
{#                  <div class = "chart">#}
{#                  </div>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#        </div>#}
      </div>

      <!-- Footer -->
      <footer class="footer bg-gradient-dark">
        <div class="row align-items-center justify-content-xl-between">
          <!--<div class="col-xl-6">-->
            <!--<div class="copyright text-center text-xl-left text-muted">-->
              <!--&copy; 2018 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">FinPro</a>-->
            <!--</div>-->
          <!--</div>-->
          <div class="col-xl-6">
            <!--<ul class="nav nav-footer justify-content-center justify-content-xl-end">-->
              <!--<li class="nav-item">-->
                <!--<a href="https://www.creative-tim.com" class="nav-link" target="_blank">Blog</a>-->
              <!--</li>-->
              <!--<li class="nav-item">-->
                <!--<a href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">About Us</a>-->
              <!--</li>-->
            <!--</ul>-->
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Core -->
  <script src="{% static 'vendor/jquery/dist/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

  <!-- Optional JS -->
  <script src="{% static 'vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'vendor/chart.js/dist/Chart.extension.js' %}"></script>

  <!-- Argon JS -->
  <script src="{% static 'js/argon.js' %}"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
  <script type="text/javascript">
        function showModal() {
              $('#word-cloud').modal('show');
        }
  </script>
  <script type="text/javascript">
      (function() {
            var margin = {top: 25, right: 0, bottom: 0, left: 0},
                width = 944,
                height = 489 - margin.top - margin.bottom,
                formatNumber = d3.format(",d"),
                transitioning;

            var x = d3.scale.linear()
                .domain([0, width])
                .range([0, width]);

            var y = d3.scale.linear()
                .domain([0, height])
                .range([0, height]);

            var color = d3.scale.threshold()
                .domain([-3,-0.25,0.25,3])
                .range(["#BB0000","#600A0A","#404040","#064D15","#1CA41C"]);

            var treemap = d3.layout.treemap()
                .children(function(d, depth) { return depth ? null : d._children; })
                .sort(function(a, b) { return a.value - b.value; })
                .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
                .round(false);

            var svg = d3.select("#heatmap").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.bottom + margin.top)
                .style("margin-left", -margin.left + "px")
                .style("opacity", 1.0)
                .style("margin.right", -margin.right + "px")
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .style("shape-rendering", "crispEdges");

            var grandparent = svg.append("g")
                .attr("class", "grandparent");

            grandparent.append("rect")
                .attr("y", -margin.top)
                .attr("width", width)
                .attr("height", margin.top);

            grandparent.append("text")
                .attr("x", 6)
                .attr("y", 6 - margin.top)
                .attr("dy", ".75em");

        d3.queue()
            .defer(d3.json, "{% static 'treemap.json' %}")
            .await(function(error, root) {
                if (error) throw error;
                initialize(root);
                accumulate(root);
                layout(root);
                display(root);

                function initialize(root) {
                  root.x = root.y = 0;
                  root.dx = width;
                  root.dy = height;
                  root.depth = 0;
                }

                function accumulate(d) {
                  return (d._children = d.children)
                      ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
                      : d.value;
                }

                function layout(d) {
                  if (d._children) {
                    treemap.nodes({_children: d._children});
                    d._children.forEach(function(c) {
                      c.x = d.x + c.x * d.dx;
                      c.y = d.y + c.y * d.dy;
                      c.dx *= d.dx;
                      c.dy *= d.dy;
                      c.parent = d;
                      layout(c);
                    });
                  }
                }

                function getContrast50(hexcolor) {
                    return (parseInt(hexcolor.replace('#', ''), 16) > 0xffffff/3) ? 'black':'white';
                }

                function display(d) {
                  grandparent
                      .datum(d.parent)
                      .on("click", transition)
                    .select("text")
                      .text(name(d));

                  grandparent
                      .datum(d.parent)
                    .select("rect")
                      .attr("fill", function(){return color(d['rate'])})

                  var g1 = svg.insert("g", ".grandparent")
                      .datum(d)
                      .attr("class", "depth");

                  var g = g1.selectAll("g")
                      .data(d._children)
                    .enter().append("g");

                  g.filter(function(d) { return d._children; })
                      .classed("children", true)
                      .on("click", transition);

                  g.selectAll(".child")
                      .data(function(d) { return d._children || [d]; })
                    .enter().append("rect")
                      .attr("class", "child")
                      .call(rect);

                  d3.select("#heatmap").select("#tooltip-sectors").remove();
                  var div = d3.select("#heatmap").append("div")
                              .attr("id", "tooltip-sectors")
                              .style("opacity", 0);


                  g.append("svg:a")
                      .attr("xlink:href", function(d) {
                          if(!d._children){
                              var url = "#";
                              return url;
                          }
                      })
                    .append("rect")
                      .attr("class", "parent")
                      .call(rect)
                      .on("mouseover", function(d) {
                             if (d.parent.name != "MARKET") {
                                 d3.select("#tooltip-sectors").transition()
                                    .duration(200)
                                    .style("opacity", 1);
                                 d3.select("#tooltip-sectors").html("<h3>"+d.name+"</h3><table>"+
                                          "<tr><td>"+d.value+"</td><td> ("+d.rate+"%)</td></tr>"+
                                          "</table>")
                                    .style("left", (d3.event.pageX-document.getElementById('heatmap').offsetLeft + 20) + "px")
                                    .style("top", (d3.event.pageY-document.getElementById('heatmap').offsetTop - 60) + "px");
                             }
                      })
                      .on("mouseout", function(d) {
                             d3.select("#tooltip-sectors").transition()
                                .duration(500)
                                .style("opacity", 0);
                      })
                    .append("title")
                      .text(function(d) { return formatNumber(d.value); });


                  g.append("text")
                      .attr("dy", ".75em")
                      .text(function(d) { return d.name; })
                      .call(text);

                  function transition(d) {
                    if (transitioning || !d) return;
                    transitioning = true;

                    var g2 = display(d),
                        t1 = g1.transition().duration(750),
                        t2 = g2.transition().duration(750);

                    x.domain([d.x, d.x + d.dx]);
                    y.domain([d.y, d.y + d.dy]);

                    svg.style("shape-rendering", null);

                    svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });

                    g2.selectAll("text").style("fill-opacity", 0);

                    t1.selectAll("text").call(text).style("fill-opacity", 0);
                    t2.selectAll("text").call(text).style("fill-opacity", 1);
                    t1.selectAll("rect").call(rect);
                    t2.selectAll("rect").call(rect);

                    t1.remove().each("end", function() {
                      svg.style("shape-rendering", "crispEdges");
                      transitioning = false;
                    });
                  }

                  return g;
                }

                function text(text) {
                  text.attr("x", function(d) { return x(d.x) + (x(d.x + d.dx) - x(d.x))/2; })
                      .attr("y", function(d) { return y(d.y) + (y(d.y + d.dy) - y(d.y))/2; })
                      .attr("dy", 0)
                      .attr("font-size", function(d) { var w=x(d.x + d.dx) - x(d.x),
                                                           h=y(d.y + d.dy) - y(d.y),
                                                           t=(d.name).length/1.3;
                                                       var tf=Math.min(Math.floor(w/t),h/3);
                                                       return (tf>=5)?Math.min(tf, 30):0; })
                      .attr("fill", "white")
                      .attr("text-anchor", "middle");
                }

                function rect(rect) {
                  rect.attr("x", function(d) { return x(d.x); })
                      .attr("y", function(d) { return y(d.y); })
                      .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
                      .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); })
                      .attr("fill", function(d){return color(parseFloat(d.rate));});
                }

                function name(d) {
                  return d.parent
                      ? "Sector : "+d.name + " (Back to Overall Market)"
                      : "Overall "+d.name;
                }
            });
            }());

  </script>

  <!-- HighStock JS -->
  <script src="https://code.highcharts.com/highcharts.js"></script>

  <!-- Stock Quotes JS -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <!--<script type="text/javascript" src="{% static 'js/jquery.stockquotes.js' %}"></script>-->
  <script type="text/javascript">
      (function ($) {
          // 'use strict';

          var SYMBOL_ENDPOINT = 'http://dev.markitondemand.com/Api/v2/Quote/jsonp';
          var PENDING_QUOTE_DELAY = 200;
          var DEFAULT_OPTIONS = {
            positiveClass: 'up',
            negativeClass: 'down',
            changeClass: 'change',
            quoteClass: 'quote',
              openClass: 'open',
            precision: 2,
            includeSymbol: false
          };
          var symbols = {};
          var pendingQuoteRequest;

          /**
           * Adds a symbol to track
           */
          function addSymbolElement (symbol, element) {
            if (!(symbol in symbols)) {
              symbols[symbol] = [];
            }
            symbols[symbol].push(element);

            // delay looking up the symbol to avoid duplicating requests as more symbols become added
            if (pendingQuoteRequest) {
              clearTimeout(pendingQuoteRequest);
            }
            pendingQuoteRequest = setTimeout(updateSymbols, PENDING_QUOTE_DELAY);
          }

          /**
           * Remotely fetchins a stock quote
           */
          function getQuote (symbol) {
            return $.ajax({
              url: SYMBOL_ENDPOINT,
              data: {symbol: symbol},
              dataType: 'jsonp',
              method: 'GET'
            }).then(function (response) {
              // return only the response
              // otherwise 3 arugments are provided to `.done` and will cause issues when dynamically mapping
              // multiple requests to responses
              return response;
            });
          }

          /**
           * Fetches all the symbol quotes and update the corresponding elements
           */
          function updateSymbols () {
            var requests = [],
                symbol;

            // fetch each quote and store the promise
            for (symbol in symbols) {
              requests.push(getQuote(symbol));
            }

            // resolve all pending promises
            // @TODO -- currently all must pass or all wil fail.
            $.when.apply($, requests).done(function () {
              // derive all the promise resolves
              var responses = Array.prototype.slice.call(arguments),
                  symbol,
                  i,
                  j;

              // go through every resolve and update the corresponding symbol elements
              for (i = 0; i < responses.length; i++) {
                for (symbol in symbols) {
                  if (responses[i].Symbol === symbol) {
                    for (j = 0; j < symbols[symbol].length; j++) {
                      symbols[symbol][j].updateQuote(responses[i]);
                    }
                  }
                }
              }
            }).fail(function (err) {
              // @TODO handle error
              console.log('err', err);
            });
          }

          function StockSymbolElement (element, symbol, options) {
            this.options = $.extend({}, DEFAULT_OPTIONS, options);
            this.$element = $(element);
            if (this.options.includeSymbol) {
              this.$element.append(symbol);
            }
            this.$element.append(' ');
            this.$change = $('<span />').addClass(this.options.changeClass);
            this.$quote = $('<span />').addClass(this.options.quoteClass);
            this.$open = $('<span />').addClass(this.options.openClass);
            this.$element.append(this.$open);
            this.$element.append('<br />');
            this.$element.append(this.$change);
            this.$element.append(this.$quote);
            addSymbolElement(symbol, this);
          }

          StockSymbolElement.prototype.updateQuote = function (quote) {
            this.$element
              .removeClass(this.options.positiveClass)
              .removeClass(this.options.negativeClass);

            if (quote.Change > 0) {
              this.$element.addClass(this.options.positiveClass);
            } else if (quote.Change < 0) {
              this.$element.addClass(this.options.negativeClass);
            }
            this.$quote.html(Math.abs(quote.Change).toFixed(this.options.precision));
            this.$open.html(Math.abs(quote.LastPrice).toFixed(this.options.precision));
          };

          $.fn.stockQuote = function (options) {
            options = $.isPlainObject(options) ? options : {};
            return this.each(function () {
              var symbol = $(this).attr('data-symbol');
              console.log(symbol);
              if (symbol) {
                symbol = symbol.toUpperCase().trim();
                $(this).data('stockquote', new StockSymbolElement(this, symbol, options));
              }
            });
          };
        })(jQuery);
  </script>
  <script type="text/javascript">
      $(document).ready(function () {
        $('.stock-quote').stockQuote();
      });
  </script>
  <!--<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>-->
  <!--<script src="https://www.amcharts.com/lib/4/core.js"></script>-->
  <!--<script src="https://www.amcharts.com/lib/4/charts.js"></script>-->
  <!--<script src="https://www.amcharts.com/lib/4/plugins/wordCloud.js"></script>-->
  <!--<script src="https://www.amcharts.com/lib/4/themes/material.js"></script>-->
  <!--<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/core.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/maps.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/geodata/worldLow.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/geodata/continentsLow.js"></script>-->
   <!--&lt;!&ndash; <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script> &ndash;&gt;-->
   <!--<script src="https://www.amcharts.com/lib/4/charts.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/plugins/wordCloud.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/themes/material.js"></script>-->
   <!--<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>-->
  <script type="text/javascript">
    function wordcloud_func(data) {

       // var text_cloud = data;
       // am4core.useTheme(am4themes_animated);
       //
       // var chart = am4core.create("wordcloud", am4plugins_wordCloud.WordCloud);
       // chart.fontFamily = "Courier New";
       // var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());
       // series.randomness = 0.1;
       // series.rotationThreshold = 0.5;
       // series.minCount = 100;
       // series.minWordLength = 5;
       //
       // series.data = text_cloud;
       //
       // series.dataFields.word = "tag";
       // series.dataFields.value = "count";
       //
       // series.heatRules.push({
       //     "target": series.labels.template,
       //     "property": "fill",
       //     "min": am4core.color("#0000CC"),
       //     "max": am4core.color("#CC00CC"),
       //     "dataField": "value"
       // });
       //
       // series.labels.template.tooltipText = "{word}:\n[bold]{value}[/]";
       //
       // am4core.useTheme(am4themes_animated);

        am4core.useTheme(am4themes_animated);
        var chart = am4core.create("wordcloud", am4plugins_wordCloud.WordCloud);
        var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());

        series.text = data;

    }
  </script>
</body>

</html>